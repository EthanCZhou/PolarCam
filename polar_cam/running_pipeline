from PySide6.QtWidgets import QApplication
from camera_control import CameraControl
from image_display import Display
from image_processor import ImageProcessor
from data_analyzer import DataAnalyzer
import sys
import cv2 as cv

from skimage import data
from skimage.feature import blob_dog

app = QApplication(sys.argv)
camera_control = CameraControl()
display = Display()
image_processor = ImageProcessor(display)
data_analyzer = DataAnalyzer()

camera_control.initialize_and_start_acquisition()

camera_control.set_parameters({"ComponentSelector": "Intensity"})
image = camera_control.get_current_frame()

print(image)

threshold = 60

ret, thresh = cv.threshold(image, threshold, 255, cv.THRESH_BINARY)

print(thresh)

blobs_dog = blob_dog(thresh)

print(blobs_dog)

for point in blobs_dog:
    cv.rectangle(thresh, (point[1] - 10, point[0] - 10), (point[1] + 10, point[0] + 10), color = (255, 0, 0))

camera_control.stop_acquisition()
camera_control.close_device()

QApplication.exit()